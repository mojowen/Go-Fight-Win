<script type="text/html" id="grouped">
	<div class="group">
		<div id="available_groups" data-bind="if: $data.groups().length > 0, visible: $data.groups().length > 0">

			<p>
				<em>grouped by</em>
			</p>

			<!-- ko foreach: $data.groups() -->
				<div class="added_group">
					<span data-bind="text: $data.name "></span>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="remove_group clickable">â€“</span>)
			
					<select data-bind="value: $data.option, options: $data.options, visible: $data.options.length > 0"></select>
				</div>
			<!-- /ko -->
		</div>

		<div id="available_groups" data-bind="if: $data.available().length > 0, visible:  $data.available().length > 0">
			<p>
				<em>click to group</em>
			</p>
			<!-- ko foreach: $data.available -->

				<span class="add_group" data-bind="text: $data.name"></span>

			<!-- /ko -->
		</div>

		<div class="menu" data-bind="visible: $data.groups().length == 2">
			<input type="checkbox" data-bind="checked: $data.pivot, visible: $data.groups().length == 2">
			<span data-bind="visible: $data.groups().length == 2" >pivot</span>

			<span data-bind="visible: dataModel.current.view().groups.pivot()">&nbsp;&nbsp;|&nbsp;&nbsp;</span>

			<span data-bind="visible: $data.groups().length == 2 && dataModel.current.view().groups.pivot()" class="swap clickable">swap</span>
			<span data-bind="visible: dataModel.current.view().groups.pivot()">&nbsp;&nbsp;|&nbsp;&nbsp;</span>

			<!-- ko if: dataModel.current.view().pivotValues().length > 0 -->
			<select data-bind="
				value: dataModel.current.view().reportOn,
				options: dataModel.current.view().pivotValues(),
				optionsText: 'long_label',
				optionsCaption: '-- select your report',
				visible: dataModel.current.view().groups.pivot"></select>
			<!-- /ko -->
		</div>
		<!-- css: {'group_field': $data.constructor.name == 'fieldModel', 'clickable' : $data.groups().length <= 2 } -->
		<table class="grouped_table" border="0" cellspacing="5" cellpadding="5" data-bind="visible: dataModel.current.view().groups.on">
			<thead>
				<tr>
					<!-- ko foreach: $data.columns  -->

					<th>
					<!-- ko if: $data.report != '_val' -->
						<span data-bind="text: $data.name"></span><br />
						<!-- ko if: $data.fieldReports != undefined -->
						<select data-bind="
							value: $data.report,
							options: $data.fieldReports,
							optionsText: 'label',
							optionsVal: 'report',
							visible: $data.fieldReports().length > 1
							"></select>
						<span data-bind="text: '('+$data.fieldReports()[0].label +')', visible: $data.fieldReports().length == 1"></span>
						<!-- /ko -->
					<!-- /ko -->
					</th>

					<!-- /ko -->
				</tr>
			</thead>

				<tbody data-bind="template: {name: 'groupedRow', foreach: $data.grouped().rows}, groups: $data" ></tbody>

			<tfoot>
				<tr>
					<!-- ko foreach: $data.columns -->
						<td>
							<!-- ko if: $data.report != '_val' && !$parent.pivot() && $data.report() != undefined -->
									<span data-bind="text: $parent.grouped()[$data.to_param][$data.report().report]"></span>
							<!-- /ko -->
							<!-- ko if: $data.report == 'all' && $parent.pivot() && dataModel.current.view().reportOn() != undefined -->
									<span data-bind="text: $parent.grouped()._uniques[1][viewModel.groupedFields().indexOf($data)-1][current.view().reportOn().name][current.view().reportOn().report]"></span>
							<!-- /ko -->

							<!-- ko if: $data.name == 'Totals' && dataModel.current.view().reportOn() != undefined -->
								<span data-bind="text: $parent.grouped()[current.view().reportOn().name][current.view().reportOn().report]"></span>
							<!-- /ko -->
						</td>
					<!-- /ko -->
				</tr>
			</tfoot>
		</table>
	</div>
</script>