<div id="goal">
	<h2 class="goal_open" >+Goal</h2>
	<div id="goal_box">

		<input data-bind="
			value: currentView().goal().value,
			valueUpdate: 'afterkeydown'
			">
		<select data-bind="
			value: currentView().goal().field,
			options: viewModel.pivotedRows(),
			optionsText: 'long_label',
			optionsCaption: '-- set goal'
			"></select>
			(<span class="clickable goal_clear">–</span>)
	</div>
</div>

<div id="group" class="area">
	<h2>+Groups</h2>

	<div id="available_groups" data-bind="if: currentView().groups().length > 0, visible: currentView().groups().length > 0">

		<p>
			<em>grouped by</em>
		</p>

		<!-- ko foreach: currentView().groups() -->
			<div class="added_group">
				<span data-bind="text: $data.name "></span>&nbsp;&nbsp;&nbsp;&nbsp;(<span class="remove_group clickable">–</span>)
				
				<select data-bind="value: $data.option, options: $data.options, visible: $data.options.length > 0"></select>
			</div>
		<!-- /ko -->
	</div>
	
	<div id="available_groups" data-bind="if: viewModel.availableGroups().length > 0, visible: viewModel.availableGroups().length > 0">
		<p>
			<em>click to group</em>
		</p>
		<!-- ko foreach: viewModel.availableGroups() -->

			<span class="add_group" data-bind="text: $data.name"></span>

		<!-- /ko -->
	</div>
	<div class="menu" data-bind="visible: currentView().groups().length == 2">
		<input type="checkbox" data-bind="checked: currentView().groups.pivot, visible: currentView().groups().length == 2">
		<span data-bind="visible: currentView().groups().length == 2" >pivot</span>

		<span data-bind="visible: currentView().groups.pivot()">&nbsp;&nbsp;|&nbsp;&nbsp;</span>

		<span data-bind="visible: currentView().groups().length == 2 && currentView().groups.pivot()" class="swap clickable">swap</span>
		<span data-bind="visible: currentView().groups.pivot()">&nbsp;&nbsp;|&nbsp;&nbsp;</span>

		<!-- ko if: currentView().pivotValues().length > 0 -->
		<select data-bind="
			value: currentView().reportOn,
			options: currentView().pivotValues(),
			optionsText: 'long_label',
			optionsCaption: '-- select your report',
			visible: currentView().groups.pivot"></select>
		<!-- /ko -->
	</div>
<!-- css: {'group_field': $data.constructor.name == 'fieldModel', 'clickable' : currentView().groups().length <= 2 } -->
	<table id="grouped_table" border="0" cellspacing="5" cellpadding="5" data-bind="visible: currentView().groups.on">
		<thead>
			<tr>
				<!-- ko foreach: viewModel.groupedFields  -->

				<th>
					<!-- ko if: $data.report != '_val' -->
						<span data-bind="text: $data.name"></span><br />
						<!-- ko if: $data.fieldReports != undefined -->
						<select data-bind="
							value: $data.report,
							options: $data.fieldReports,
							optionsText: 'label',
							optionsVal: 'report',
							visible: $data.fieldReports().length > 1
							"></select>
						<span data-bind="text: '('+$data.fieldReports()[0].label +')', visible: $data.fieldReports().length == 1"></span>
						<!-- /ko -->
					<!-- /ko -->
				</th>

				<!-- /ko -->
			</tr>
		</thead>

			<tbody data-bind="template: {name: 'groupedRow', foreach: viewModel.groupedRows().rows}" ></tbody>

		<tfoot>
			<tr>
				<!-- ko foreach: viewModel.groupedFields -->
					<td>
						<!-- ko if: $data.report != '_val' && !currentView().groups.pivot() && $data.report() != undefined -->
								<span data-bind="text: viewModel.groupedRows()[$data.to_param][$data.report().report]"></span>
						<!-- /ko -->
						<!-- ko if: $data.report == 'all' && currentView().groups.pivot() && currentView().reportOn() != undefined -->
								<span data-bind="text: viewModel.groupedRows()._uniques[1][viewModel.groupedFields().indexOf($data)-1][currentView().reportOn().name][currentView().reportOn().report]"></span>
						<!-- /ko -->

						<!-- ko if: $data.name == 'Totals' && currentView().reportOn() != undefined -->
							<span data-bind="text: viewModel.groupedRows()[currentView().reportOn().name][currentView().reportOn().report]"></span>
						<!-- /ko -->
					</td>
				<!-- /ko -->
			</tr>
		</tfoot>
	</table>
</div>
